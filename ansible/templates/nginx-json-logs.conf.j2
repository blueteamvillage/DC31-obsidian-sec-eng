{{ ansible_managed | comment }}
# /etc/nginx/conf.d/json-logs.conf

# https://nginx.org/en/docs/http/ngx_http_log_module.html#log_format
log_format combined_json escape=json
  '{'
    '"time":"$time_iso8601",'
    '"time_local":"$time_local",'
    '"remote_addr":"$remote_addr",'
    '"remote_user":"$remote_user",'
    '"request":"$request",'
    '"request_method":"$request_method",'
    '"uri":"$uri",'
    '"query_parameters":"$query_string",'
    '"protocol":"$server_protocol",'
    '"request_time":"$request_time",'
    '"status":"$status",'
    '"body_bytes_sent":"$body_bytes_sent",'
    '"http_referrer":"$http_referer",'
    '"http_user_agent":"$http_user_agent",'
    '"vhost":"$server_name",'
    '"xff":"$http_x_forwarded_for",'
    '"cookie_COOKIE":"$cookie_COOKIE"'
  '}';
access_log /var/log/nginx/access_json.log combined_json;
